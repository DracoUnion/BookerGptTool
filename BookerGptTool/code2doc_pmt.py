OVVW_PMT = '''
你是一位资深架构师，文档专家和逻辑分析专家。你的工作是遵循一系列的步骤，生成给定代码的详细设计文档。该文档包含如下：

1. 一段话描述，用一段话概述该代码的核心功能
1. 文件的整体运行流程
2. 类的详细信息，包含类字段和类方法，以及全局变量和全局函数的详细信息
3. 对于类字段和全局变量，应包含名称、类型和一句话描述。
4. 对于类方法和全局函数，应包含名称、参数名称、参数类型、参数描述、返回值类型、返回值描述、mermaid 流程图、和带注释源码。
5. 关键组件信息，包含名称和一句话描述
6. 潜在的技术债务或优化空间
7. 其它项目，例如设计目标与约束、错误处理与异常设计、数据流与状态机、外部依赖与接口契约等等。

## 任务

请分析以下源代码，生成一份详细设计文档的大纲。

## 要求

1.  大纲包含一段话描述，用一段话概述该代码的核心功能。
2.  分析代码的整体工作流程，输出 mermaid。
3.  分析代码的类层次结构，输出树状图。
2.  识别出代码中的所有类名、类字段名、类方法名、全局变量名和全局函数名。
3.  将这些元素分类，准备进入下一步的详细解析。
4.  JSON 格式输出，注意输出包含在三个反引号（```）中。

## 格式

```
{
    "file": "xxx.py",
    "desc": "the file ....",
    "process": [
        "graph TD",
        "    A[开始] --> B{金额 > 0?}",
        "    B -- 否 --> C[抛出 ValueError]",
        "    B -- 是 --> D[调用第三方支付网关]",
        "    D --> E{网关返回成功?}",
        "    E -- 是 --> F[更新订单状态]",
        "    E -- 否 --> G[记录日志并重试]",
        "    ..."
    ],
    "structure": [
        "ModelBase (抽象基类)",
        "├── TextModel (文本模型基类)",
        "│   ├── LlamaModel",
        "│   ├── GPT2Model",
        "│   ├── FalconModel",
        "│   ├── Qwen2Model",
        "│   ├── GemmaModel",
        "│   └── ... "
    ],
    "classes": [
        {
            "name": "Class1",
            "fields": ["field1", "..."],
            "methods": ["method1", "..."]
        },
        { ... }
    ],
    "vars": ["var1", "..."],
    "funcs": ["func1", "..."]
}
```

## 代码

```
{code}
```
'''

VAR_FLD_EXT_PMT = '''
你是一位资深架构师，文档专家和逻辑分析专家。你的工作是遵循一系列的步骤，生成给定代码的详细设计文档。该文档包含如下：

1. 一段话描述，用一段话概述该代码的核心功能
1. 文件的整体运行流程
2. 类的详细信息，包含类字段和类方法，以及全局变量和全局函数的详细信息
3. 对于类字段和全局变量，应包含名称、类型和一句话描述。
4. 对于类方法和全局函数，应包含名称、参数名称、参数类型、参数描述、返回值类型、返回值描述、mermaid 流程图、和带注释源码。
5. 关键组件信息，包含名称和一句话描述
6. 潜在的技术债务或优化空间
7. 其它项目，例如设计目标与约束、错误处理与异常设计、数据流与状态机、外部依赖与接口契约等等。

## 任务

你的任务是根据给定的代码和给定的类字段名和全局变量名称，生成它的类型和一句话描述。JSON 格式输出，注意输出包含在三个反引号（```）中。

## 代码

```
{code}
```

## 类字段名和全局变量名

```
{vars}
```

## 格式

```
{
    "vars": [
        {"name": "var1", "type": "...", "desc": "..."},
        { ... }
    ],
    "fields: [
        {"name": "var1", "class": "class1", "type": "...", "desc": "..."},
        { ... }
    ]
}
```
'''

FUNC_MTD_EXT_PMT = '''
你是一位资深架构师，文档专家和逻辑分析专家。你的工作是遵循一系列的步骤，生成给定代码的详细设计文档。该文档包含如下：

1. 一段话描述，用一段话概述该代码的核心功能
1. 文件的整体运行流程
2. 类的详细信息，包含类字段和类方法，以及全局变量和全局函数的详细信息
3. 对于类字段和全局变量，应包含名称、类型和一句话描述。
4. 对于类方法和全局函数，应包含名称、参数名称、参数类型、参数描述、返回值类型、返回值描述、mermaid 流程图、和带注释源码。
5. 关键组件信息，包含名称和一句话描述
6. 潜在的技术债务或优化空间
7. 其它项目，例如设计目标与约束、错误处理与异常设计、数据流与状态机、外部依赖与接口契约等等。

## 任务

从代码中提取给定函数或方法{func}，输出名称（{函数名}或{类名}.{方法名}）、参数名称、参数类型、参数描述、返回值类型、返回值描述、mermaid 流程图、和带注释源码。

## 代码

```
{code}
```

## 格式

[content]
### `{名称}`

{描述}

参数：

-  `{参数名称}`：`{参数类型}`，{参数描述}
-  ...

返回值：`{返回值类型}`，{返回值描述}

### 流程图

```mermaid
{流程图}
```

### 带注释源码

```
{源码}
```
[/content]
'''

KEY_CMPN_PMT = '''
你是一位资深架构师，文档专家和逻辑分析专家。你的工作是遵循一系列的步骤，生成给定代码的详细设计文档。该文档包含如下：

1. 一段话描述，用一段话概述该代码的核心功能
1. 文件的整体运行流程
2. 类的详细信息，包含类字段和类方法，以及全局变量和全局函数的详细信息
3. 对于类字段和全局变量，应包含名称、类型和一句话描述。
4. 对于类方法和全局函数，应包含名称、参数名称、参数类型、参数描述、返回值类型、返回值描述、mermaid 流程图、和带注释源码。
5. 关键组件信息，包含名称和一句话描述
6. 潜在的技术债务或优化空间
7. 其它项目，例如设计目标与约束、错误处理与异常设计、数据流与状态机、外部依赖与接口契约等等。

## 任务

识别源代码中的关键组件（如张量索引与惰性加载、反量化支持、量化策略），Markdown 格式输出。注意只需要输出格式中包含的内容，不要输出任何其它东西。

## 代码

```
{code}
```

## 格式

[content]
### {组件1}

{描述1}

### {组件2}

{描述2}

...
[/content]
'''

ADVC_PMT = '''
你是一位资深架构师，文档专家和逻辑分析专家。你的工作是遵循一系列的步骤，生成给定代码的详细设计文档。该文档包含如下：

1. 一段话描述，用一段话概述该代码的核心功能
1. 文件的整体运行流程
2. 类的详细信息，包含类字段和类方法，以及全局变量和全局函数的详细信息
3. 对于类字段和全局变量，应包含名称、类型和一句话描述。
4. 对于类方法和全局函数，应包含名称、参数名称、参数类型、参数描述、返回值类型、返回值描述、mermaid 流程图、和带注释源码。
5. 关键组件信息，包含名称和一句话描述
6. 潜在的技术债务或优化空间
7. 其它项目，例如设计目标与约束、错误处理与异常设计、数据流与状态机、外部依赖与接口契约等等。

## 任务

根据代码分析潜在的技术债务或优化空间，提出已知问题和建议。注意只需要输出格式中包含的内容，不要输出任何其它东西。

## 代码

```
{code}
```

## 格式

[content]
### 已知问题

-   {问题1}
-   ....

### 优化建议

-   {建议1}
-   ....
[/content]
'''

ETC_PMT = '''
你是一位资深架构师，文档专家和逻辑分析专家。你的工作是遵循一系列的步骤，生成给定代码的详细设计文档。该文档包含如下：

1. 一段话描述，用一段话概述该代码的核心功能
1. 文件的整体运行流程
2. 类的详细信息，包含类字段和类方法，以及全局变量和全局函数的详细信息
3. 对于类字段和全局变量，应包含名称、类型和一句话描述。
4. 对于类方法和全局函数，应包含名称、参数名称、参数类型、参数描述、返回值类型、返回值描述、mermaid 流程图、和带注释源码。
5. 关键组件信息，包含名称和一句话描述
6. 潜在的技术债务或优化空间
7. 其它项目，例如设计目标与约束、错误处理与异常设计、数据流与状态机、外部依赖与接口契约等等。

## 任务

我们已经包含了一段话概述、整体流程、类结构、类字段、类方法、全局变量、全局函数信息、关键组件信息、问题及改进建议。请列举详细设计文档还应该包含什么项目（如设计目标与约束、错误处理与异常设计、数据流与状态机、外部依赖与接口契约等等），并填写项目内容。注意只需要输出格式中包含的内容，不要输出任何其它东西。

## 代码

```
{code}
```

## 格式

[content]
### {项目1}

{内容1}

### {项目2}

{内容2}

....
[/content]
'''